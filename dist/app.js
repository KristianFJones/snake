(()=>{"use strict";var e={up:38,down:40,left:37,right:39,enter:13,R:82,H:72,J:74,K:75,L:76,space:32},t=function(e){var t=n.indexOf(e);return-1!==t?r[t]:e},n=[e.K,e.H,e.L,e.J],r=[e.up,e.left,e.right,e.down],i=[].concat(r,n);const a=e;function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;o(this,e),this.move(t,n)}var t,n;return t=e,(n=[{key:"move",value:function(e,t){this.x=e,this.y=t}},{key:"equals",value:function(e){return this.x===e.x&&this.y===e.y}}])&&c(t.prototype,n),e}();function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(e){return e+1},f=function(e){return e-1};const h=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.points=[new l],this.headed=a.right,this.tail=0,this.alive=!0}var t,n;return t=e,(n=[{key:"getHead",value:function(){return this.points[0]}},{key:"consume",value:function(){this.points.push(Object.assign({},this.getHead())),++this.tail}},{key:"tick",value:function(){var e,t,n=this,r=a.up,i=a.left,o=a.right,c=a.down,u=this.getHead(),h=new l(u.x,u.y);switch(this.headed){case r:case i:e=f;break;case c:case o:e=s}switch(this.headed){case r:case c:t="y";break;case i:case o:t="x"}return h[t]=e(h[t]),this.points.unshift(h),this.points.pop(),this.points.slice(1).forEach((function(e){e.x===h.x&&e.y===h.y&&(n.alive=!1)})),h}}])&&u(t.prototype,n),e}();var d,v,y=-1,p=!0;"function"==typeof AudioContext&&(d=new AudioContext,(v=d.createGain()).gain.value=.3,v.connect(d.destination));var w,g=[16.35,18.35,20.6,21.83,24.5,27.5,30.87,32.7];function x(e,t){return(0,Math.floor)((0,Math.random)()*(t-e+1))+e}!function(e){e[e.INTRO=0]="INTRO",e[e.INGAME=1]="INGAME",e[e.DEAD=2]="DEAD"}(w||(w={}));var m={screen:w.INTRO,player:null,width:0,height:0,food:null};function k(e){for(var t=m.player.points,n=0;n<t.length;++n)if(t[n].equals(e))return!0;return!1}function A(e){var t,n=e.width,r=e.height;do{t=new l(x(0,n-1),x(0,r-1))}while(k(t));e.food.move(t.x,t.y),++e.player.tail}function T(e){var t=e.player,n=t.getHead();n.x===e.food.x&&n.y===e.food.y&&(A(e),t.consume(),function(){if(d){var e=d.createOscillator(),t=d.createOscillator();p?++y==g.length-1&&(p=!1):0==--y&&(p=!0);var n=10*g[y];e.frequency.value=n,e.type="sawtooth",t.frequency.value=n,t.type="triangle",e.connect(v),t.connect(v),e.start(d.currentTime),t.start(d.currentTime),e.stop(d.currentTime+.25),t.stop(d.currentTime+.25)}}());var r=t.tick(),i=r.x,a=r.y;return!(i<0||a<0||i>e.width-1||a>e.height-1)||(t.alive=!1,!1)}function E(e,t){return m.width=e,m.height=t,m.player=new h,m.food=new l,A(m),m}var b=!1;const R=function(e,t){if(b)return console.log("restoring cache",b),void t.restore();var n=50,r=function(t){var r=t*e;return n+=r,r};t.font="".concat(r(1.5),"px sans-serif"),t.strokeText("Snake",10,n,2.5*e),t.font="".concat(r(.7),"px Arial"),t.fillText("by avindra",65,n),t.font="".concat(r(.55),"px Arial"),t.fillText("Use arrow keys to move.",10,n),t.font="".concat(r(.85),"px Arial"),t.fillText("Press ENTER to start",10,n),b||(t.save(),b=!0)},I=function(e,t,n,r){var i=t.player,o=t.food;e.fillStyle="black",e.fillRect(0,0,n.width,n.height);var c=i.alive;e.fillStyle=c?"red":"white",e.fillRect(o.x*r,o.y*r,r,r),e.fillStyle=c?"white":"red",i.points.forEach((function(t){return e.fillRect(t.x*r,t.y*r,r,r)}));var l=i.getHead();e.fillStyle="green";var u=0,s=l.x*r,f=l.y*r,h=r/5,d=r-h;switch(i.headed!==a.down&&i.headed!==a.right||(u=d),i.headed){case a.down:case a.up:e.fillRect(s,f+u,h,h),e.fillRect(s+d,f+u,h,h);break;case a.right:case a.left:e.fillRect(s+u,f,h,h),e.fillRect(s+u,f+d,h,h);break;default:throw new Error("wat")}var v=i.points.length-1;c?T(t):function(e,t,n){var r=50,i=function(t){var n=t*e;return r+=n,n};t.font="".concat(i(1.5),"px Arial"),t.fillText("You died :/",10,r),t.font="".concat(i(.7),"px Arial"),t.fillText("Your final score is ".concat(n),17,r),t.font="".concat(i(1.4),"px Arial"),t.fillText("Press Enter to respawn",10,r)}(r,e,v)};var N=("game",document.getElementById("game")),O=window.innerHeight/20,M=E(20,20);window.onkeydown=function(e){var n=e.keyCode,r=M.player,o=t(n);o===a.R?(M=E(20,20)).screen=w.INGAME:o===a.enter&&(M.screen=w.INGAME),i.find((function(e){return e===o}))&&(e.preventDefault(),r.headed=o)},N.width=20*O,N.height=20*O,requestAnimationFrame((function e(){var t=M.screen;t===w.INTRO?R(O,ctx):t===w.INGAME&&I(ctx,M,N,O),setTimeout((function(){requestAnimationFrame(e)}),50)})),function(e,n,r,o){var c=E(20,20);e.width=20*o,e.height=20*o,window.onkeydown=function(e){var n=e.keyCode,r=c.player,o=t(n),l=o==a.enter,u=o==a.space,s=o===a.R;!r.alive&&(l||u)||s?(c=E(20,20)).screen=w.INGAME:l&&(c.screen=w.INGAME),i.find((function(e){return e===o}))&&(e.preventDefault(),r.headed=o)};var l=function(e,t,n){var r=t.getContext("2d");return function(){var i=e.screen;i===w.INTRO?R(n,r):i===w.INGAME&&I(r,e,t,n)}}(c,e,o);setInterval((function(){requestAnimationFrame(l)}),50)}(N,0,0,O)})();